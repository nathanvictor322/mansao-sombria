<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>A Mans√£o Sombria - Mobile</title>
    <style>
        /* Reset e configura√ß√µes mobile */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        html, body {
            height: 100%;
            overflow: hidden;
            background-color: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            line-height: 1.4;
        }
        
        /* Container principal */
        .game-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 10px;
            max-width: 100%;
            overflow-y: auto;
        }
        
        /* Header */
        .game-header {
            text-align: center;
            padding: 15px 0;
            border-bottom: 2px solid #8b0000;
            margin-bottom: 15px;
        }
        
        .game-title {
            font-size: 1.8rem;
            color: #ff0000;
            text-shadow: 0 0 10px #8b0000;
            margin-bottom: 5px;
            letter-spacing: 1px;
        }
        
        .game-subtitle {
            color: #aaa;
            font-size: 0.9rem;
        }
        
        /* Barra de sanidade - otimizada para mobile */
        .sanity-container {
            background: #111;
            border: 1px solid #333;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 0 10px rgba(139, 0, 0, 0.3);
        }
        
        .sanity-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 1rem;
        }
        
        .sanity-bar {
            height: 30px;
            background: #222;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }
        
        .sanity-fill {
            height: 100%;
            width: 100%;
            background: linear-gradient(90deg, #006400, #00aa00, #ffff00, #ff6600, #ff0000);
            transition: width 0.5s ease;
            border-radius: 15px;
        }
        
        .sanity-text {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            text-shadow: 1px 1px 2px #000;
        }
        
        /* √Årea da hist√≥ria */
        .story-container {
            flex-grow: 1;
            background: #111;
            border: 1px solid #333;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            overflow-y: auto;
            max-height: 40vh;
            box-shadow: 0 0 10px rgba(139, 0, 0, 0.3);
        }
        
        .story-text {
            font-size: 1.1rem;
            line-height: 1.6;
            text-align: justify;
        }
        
        /* √Årea de escolhas - otimizada para touch */
        .choices-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-top: 10px;
        }
        
        .choice-btn {
            background: #222;
            border: 2px solid #444;
            color: #fff;
            padding: 18px 15px;
            text-align: left;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            min-height: 60px;
            display: flex;
            align-items: center;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }
        
        .choice-btn:active {
            transform: scale(0.98);
            background: #2a2a2a;
            border-color: #ff0000;
        }
        
        .choice-btn:hover {
            background: #2a2a2a;
            border-color: #8b0000;
        }
        
        .choice-btn::before {
            content: "‚ñ∂";
            margin-right: 10px;
            color: #8b0000;
            font-size: 0.9rem;
        }
        
        /* Tela de game over */
        .game-over {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 20px;
            z-index: 1000;
            text-align: center;
        }
        
        .game-over h2 {
            font-size: 2.5rem;
            color: #ff0000;
            margin-bottom: 20px;
            text-shadow: 0 0 15px #ff0000;
        }
        
        .game-over p {
            font-size: 1.2rem;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        .restart-btn {
            background: #8b0000;
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 1.3rem;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 20px;
            min-width: 200px;
            touch-action: manipulation;
        }
        
        .restart-btn:active {
            transform: scale(0.95);
            background: #a30000;
        }
        
        /* Controles mobile */
        .mobile-controls {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            margin-top: 10px;
            border-top: 1px solid #333;
        }
        
        .mobile-btn {
            background: #222;
            border: 1px solid #444;
            color: #fff;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
        }
        
        /* Efeitos visuais para mobile */
        .mobile-effects {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .flicker {
            position: absolute;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.03);
            opacity: 0;
            animation: flicker 8s infinite;
        }
        
        @keyframes flicker {
            0%, 100% { opacity: 0; }
            5%, 95% { opacity: 0.02; }
            15%, 85% { opacity: 0.05; }
            25%, 75% { opacity: 0.02; }
            35%, 65% { opacity: 0.04; }
            45%, 55% { opacity: 0.03; }
            50% { opacity: 0; }
        }
        
        /* Notifica√ß√µes mobile */
        .mobile-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(139, 0, 0, 0.9);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            z-index: 1001;
            display: none;
            text-align: center;
            max-width: 90%;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }
        
        /* Scrollbar customizada */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #111;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #8b0000;
            border-radius: 4px;
        }
        
        /* Landscape mode */
        @media (orientation: landscape) {
            .game-container {
                flex-direction: row;
                flex-wrap: wrap;
            }
            
            .game-header {
                width: 100%;
                padding: 10px 0;
            }
            
            .sanity-container {
                width: 100%;
                margin-bottom: 10px;
            }
            
            .story-container {
                width: 60%;
                max-height: 60vh;
                margin-right: 10px;
            }
            
            .choices-container {
                width: 38%;
                max-height: 60vh;
                overflow-y: auto;
            }
            
            .game-title {
                font-size: 1.5rem;
            }
        }
        
        /* Telas muito pequenas */
        @media (max-width: 360px) {
            .game-title {
                font-size: 1.5rem;
            }
            
            .story-text {
                font-size: 1rem;
            }
            
            .choice-btn {
                padding: 15px 12px;
                font-size: 0.95rem;
                min-height: 55px;
            }
        }
    </style>
</head>
<body>
    <!-- Efeitos visuais -->
    <div class="mobile-effects">
        <div class="flicker"></div>
    </div>
    
    <!-- Notifica√ß√£o mobile -->
    <div class="mobile-notification" id="mobileNotification"></div>
    
    <!-- Container principal do jogo -->
    <div class="game-container">
        <header class="game-header">
            <h1 class="game-title">A MANS√ÉO SOMBRIA</h1>
            <p class="game-subtitle">Sua sanidade determinar√° seu destino</p>
        </header>
        
        <div class="sanity-container">
            <div class="sanity-label">
                <span>SANIDADE</span>
                <span id="sanityValue">100%</span>
            </div>
            <div class="sanity-bar">
                <div class="sanity-fill" id="sanityFill"></div>
                <div class="sanity-text" id="sanityText">Est√°vel</div>
            </div>
        </div>
        
        <div class="story-container">
            <div class="story-text" id="storyText">
                Voc√™ est√° parado diante da Mans√£o Blackwood, uma constru√ß√£o antiga e decadente que h√° anos √© evitada pelos moradores da cidade. A noite est√° escura, sem luar, e o vento sussurra entre as √°rvores mortas do jardim. Voc√™ est√° aqui porque sua irm√£ desapareceu ap√≥s entrar nesta mans√£o tr√™s dias atr√°s. As √∫nicas pistas que voc√™ tem s√£o uma carta enigm√°tica e um di√°rio antigo que ela deixou para tr√°s. A porta da frente est√° entreaberta, rangendo levemente com o vento. O que voc√™ faz?
            </div>
        </div>
        
        <div class="choices-container" id="choicesContainer">
            <!-- As escolhas ser√£o inseridas aqui pelo JavaScript -->
        </div>
        
        <!-- Controles mobile -->
        <div class="mobile-controls">
            <button class="mobile-btn" onclick="toggleSound()" id="soundBtn">üîä Som</button>
            <button class="mobile-btn" onclick="showInstructions()">‚ùì Ajuda</button>
            <button class="mobile-btn" onclick="restartGame()">üîÑ Reiniciar</button>
        </div>
    </div>
    
    <!-- Tela de game over -->
    <div class="game-over" id="gameOverScreen">
        <h2 id="gameOverTitle">FIM DE JOGO</h2>
        <p id="gameOverText"></p>
        <button class="restart-btn" id="restartBtn">JOGAR NOVAMENTE</button>
    </div>

    <!-- √Åudios (com fallback para mobile) -->
    <audio id="bgSound" loop preload="auto">
        <source src="https://assets.mixkit.co/music/preview/mixkit-dark-ambience-388.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="clickSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3" type="audio/mpeg">
    </audio>
    
    <script>
        // Detectar se √© mobile
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        // Configura√ß√£o para mobile
        if (isMobile) {
            // Ajustar viewport
            document.querySelector('meta[name="viewport"]').setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no');
            
            // Mostrar instru√ß√µes
            setTimeout(() => {
                showNotification("Toque nas op√ß√µes para fazer escolhas. Mantenha sua sanidade acima de 0!");
            }, 1000);
        }
        
        // Elementos do DOM
        const storyText = document.getElementById('storyText');
        const choicesContainer = document.getElementById('choicesContainer');
        const sanityFill = document.getElementById('sanityFill');
        const sanityText = document.getElementById('sanityText');
        const sanityValue = document.getElementById('sanityValue');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const gameOverTitle = document.getElementById('gameOverTitle');
        const gameOverText = document.getElementById('gameOverText');
        const restartBtn = document.getElementById('restartBtn');
        const mobileNotification = document.getElementById('mobileNotification');
        const soundBtn = document.getElementById('soundBtn');
        
        // Elementos de √°udio
        const bgSound = document.getElementById('bgSound');
        const clickSound = document.getElementById('clickSound');
        
        // Estado do jogo
        let gameState = {
            sanity: 100,
            currentScene: "start",
            soundEnabled: false,
            visitedScenes: new Set(["start"]),
            foundSister: false,
            hasKey: false
        };
        
        // Sistema de notifica√ß√£o para mobile
        function showNotification(message, duration = 3000) {
            mobileNotification.textContent = message;
            mobileNotification.style.display = 'block';
            setTimeout(() => {
                mobileNotification.style.display = 'none';
            }, duration);
        }
        
        // Sistema de √°udio (adaptado para mobile)
        function toggleSound() {
            gameState.soundEnabled = !gameState.soundEnabled;
            soundBtn.textContent = gameState.soundEnabled ? "üîä Som ON" : "üîá Som OFF";
            
            if (gameState.soundEnabled) {
                bgSound.volume = 0.3;
                const playPromise = bgSound.play();
                if (playPromise !== undefined) {
                    playPromise.catch(e => {
                        showNotification("Toque em qualquer lugar para ativar o som");
                        document.body.addEventListener('touchstart', enableAudio, { once: true });
                    });
                }
            } else {
                bgSound.pause();
            }
        }
        
        function enableAudio() {
            if (gameState.soundEnabled) {
                bgSound.play().catch(e => console.log("√Åudio ainda bloqueado"));
            }
        }
        
        // Instru√ß√µes para mobile
        function showInstructions() {
            showNotification("Toque nas op√ß√µes para escolher. Cuidado: escolhas erradas reduzem sua sanidade!", 5000);
        }
        
        // Cenas completas do jogo
        const scenes = {
            start: {
                text: "Voc√™ est√° parado diante da Mans√£o Blackwood, uma constru√ß√£o antiga e decadente que h√° anos √© evitada pelos moradores da cidade. A noite est√° escura, sem luar, e o vento sussurra entre as √°rvores mortas do jardim. Voc√™ est√° aqui porque sua irm√£ desapareceu ap√≥s entrar nesta mans√£o tr√™s dias atr√°s. As √∫nicas pistas que voc√™ tem s√£o uma carta enigm√°tica e um di√°rio antigo que ela deixou para tr√°s. A porta da frente est√° entreaberta, rangendo levemente com o vento. O que voc√™ faz?",
                choices: [
                    { text: "Entrar pela porta da frente", next: "entrance", sanityChange: -5 },
                    { text: "Dar a volta e tentar uma entrada pelos fundos", next: "backdoor", sanityChange: 0 },
                    { text: "Procurar por uma janela aberta", next: "window", sanityChange: -2 },
                    { text: "Desistir e voltar para a cidade", next: "giveup", sanityChange: 10 }
                ]
            },
            entrance: {
                text: "Voc√™ empurra a pesada porta de madeira, que range alto ao se mover. O interior da mans√£o √© ainda mais escuro que o exterior, e o ar √© pesado com o cheiro de mofo e algo mais... met√°lico. Na entrada, h√° um grande hall com uma escadaria que leva ao andar superior. √Ä sua esquerda, uma porta entreaberta revela o que parece ser uma sala de estar. √Ä direita, um corredor escuro. No ch√£o, voc√™ v√™ pegadas recentes na poeira. Elas parecem levar para cima.",
                choices: [
                    { text: "Seguir as pegadas pela escada", next: "stairs", sanityChange: -8 },
                    { text: "Investigar a sala √† esquerda", next: "livingroom", sanityChange: -3 },
                    { text: "Explorar o corredor √† direita", next: "corridor", sanityChange: -5 },
                    { text: "Voltar para fora e reconsiderar", next: "start", sanityChange: 5 }
                ]
            },
            backdoor: {
                text: "Voc√™ contorna a mans√£o, trope√ßando em arbustos mortos e detritos. Os fundos s√£o ainda mais sombrios, com uma velha cozinha de servi√ßo cuja porta est√° parcialmente destru√≠da. Ao entrar, voc√™ v√™ um fog√£o antigo, uma mesa coberta com utens√≠lios enferrujados e algo que parece ser sangue seco no ch√£o. H√° uma porta que leva para dentro da mans√£o e uma escada estreita que desce para um por√£o.",
                choices: [
                    { text: "Entrar na mans√£o pela cozinha", next: "kitchen", sanityChange: -4 },
                    { text: "Descer a escada para o por√£o", next: "basement", sanityChange: -12 },
                    { text: "Procurar por pistas na cozinha", next: "kitchen_clues", sanityChange: -6 },
                    { text: "Sair e voltar para a frente da mans√£o", next: "start", sanityChange: 0 }
                ]
            },
            window: {
                text: "Voc√™ anda ao redor da mans√£o, encontrando v√°rias janelas, mas todas est√£o trancadas ou emperradas. Finalmente, no lado leste, voc√™ encontra uma janela quebrada, grande o suficiente para passar. Ao entrar, voc√™ se encontra em uma biblioteca empoeirada. Estantes cheias de livros antigos cobrem as paredes. No centro da sala, uma poltrona est√° virada para uma lareira apagada. No ch√£o, perto da poltrona, voc√™ v√™ um livro aberto com uma marca√ß√£o.",
                choices: [
                    { text: "Examinar o livro aberto", next: "book", sanityChange: -8 },
                    { text: "Procurar por uma sa√≠da da biblioteca", next: "library_exit", sanityChange: -3 },
                    { text: "Investigar as estantes de livros", next: "bookshelves", sanityChange: -5 },
                    { text: "Voltar pela janela", next: "start", sanityChange: 2 }
                ]
            },
            giveup: {
                text: "Voc√™ decide que isso √© loucura. A mans√£o tem uma reputa√ß√£o terr√≠vel e voc√™ n√£o est√° preparado para enfrentar o que possa estar l√° dentro. Vira as costas e come√ßa a caminhar de volta para a cidade, prometendo a si mesmo que vai chamar as autoridades pela manh√£. Mas conforme voc√™ se afasta, voc√™ jura ouvir um grito abafado vindo da mans√£o... o grito de sua irm√£. Sua sanidade se recupera um pouco, mas a culpa come√ßa a consumi-lo.",
                gameOver: true,
                title: "DESIST√äNCIA",
                ending: "Voc√™ sobreviveu, mas abandonou sua irm√£. Sua consci√™ncia nunca lhe dar√° paz."
            },
            stairs: {
                text: "Voc√™ sobe as escadas, cada degrau rangendo sob seu peso. No topo, um longo corredor se estende √† sua frente, com v√°rias portas de cada lado. O corredor √© iluminado apenas por uma fraca luz lunar que entra por uma janela no final. De repente, voc√™ ouve um choro abafado vindo de uma das portas √† sua direita. Ao mesmo tempo, uma sombra parece se mover na extremidade do corredor.",
                choices: [
                    { text: "Seguir o som do choro", next: "crying_room", sanityChange: -10 },
                    { text: "Investigar a sombra no final do corredor", next: "shadow", sanityChange: -15 },
                    { text: "Abrir a primeira porta √† esquerda", next: "bedroom", sanityChange: -7 },
                    { text: "Voltar descer as escadas", next: "entrance", sanityChange: 3 }
                ]
            },
            livingroom: {
                text: "Voc√™ entra na sala de estar. M√≥veis antigos cobertos com len√ß√≥is brancos est√£o dispostos pela sala. Uma grande lareira domina uma das paredes, com um retrato acima dela que parece ter os olhos arrancados. No centro da sala, h√° uma mesa de centro com um √∫nico livro em cima. O livro est√° aberto em uma p√°gina que mostra um s√≠mbolo estranho.",
                choices: [
                    { text: "Examinar o livro", next: "livingroom_book", sanityChange: -10 },
                    { text: "Olhar o retrato sem olhos", next: "portrait", sanityChange: -8 },
                    { text: "Procurar por sa√≠das", next: "livingroom_exit", sanityChange: -3 },
                    { text: "Voltar para o hall", next: "entrance", sanityChange: 2 }
                ]
            },
            corridor: {
                text: "Voc√™ entra no corredor escuro. Sua vis√£o leva um tempo para se ajustar. O corredor parece se estender muito al√©m do que deveria ser poss√≠vel dentro da mans√£o. Nas paredes, quadros retratam pessoas com express√µes de terror. Voc√™ ouve sussurros vindo do final do corredor.",
                choices: [
                    { text: "Seguir em frente", next: "corridor_end", sanityChange: -15 },
                    { text: "Examinar os quadros", next: "paintings", sanityChange: -12 },
                    { text: "Voltar correndo", next: "entrance", sanityChange: -5 },
                    { text: "Chamar por ajuda", next: "call_for_help", sanityChange: -8 }
                ]
            },
            kitchen: {
                text: "Voc√™ entra na mans√£o pela cozinha. O lugar est√° em estado lastim√°vel, com m√≥veis quebrados e utens√≠lios espalhados pelo ch√£o. Na mesa, voc√™ encontra uma lanterna que ainda funciona. Ao lig√°-la, voc√™ v√™ portas que levam para um corredor e para uma despensa. De repente, voc√™ ouve um barulho vindo da despensa.",
                choices: [
                    { text: "Investigar a despensa", next: "pantry", sanityChange: -8 },
                    { text: "Seguir pelo corredor", next: "hallway", sanityChange: -5 },
                    { text: "Procurar por armas", next: "weapons", sanityChange: -2 },
                    { text: "Voltar para fora", next: "backdoor", sanityChange: 3 }
                ]
            },
            kitchen_clues: {
                text: "Voc√™ procura por pistas na cozinha. Entre os utens√≠lios enferrujados, voc√™ encontra um recibo antigo de uma farm√°cia local, datado de 50 anos atr√°s. O nome 'Blackwood' est√° escrito nele. Na gaveta, voc√™ encontra uma faca afiada que ainda parece √∫til. Tamb√©m nota que h√° uma porta dos fundos, mas est√° trancada com um cadeado pesado.",
                choices: [
                    { text: "Pegar a faca", next: "backdoor", sanityChange: -2 },
                    { text: "Tentar for√ßar a porta dos fundos", next: "force_backdoor", sanityChange: -5 },
                    { text: "Voltar para os fundos da mans√£o", next: "backdoor", sanityChange: 0 }
                ]
            },
            basement: {
                text: "A escada para o por√£o range perigosamente sob seus p√©s. Ao chegar abaixo, o cheiro de decomposi√ß√£o √© quase insuport√°vel. O por√£o √© √∫mido e escuro, com apenas uma pequena janela suja deixando entrar um pouco de luz lunar. Voc√™ acende sua lanterna e v√™ que o lugar est√° cheio de velhos m√≥veis cobertos com len√ß√≥is. No centro, h√° uma mesa de madeira com correntes e manchas escuras. De repente, voc√™ ouve um barulho de arrastar vindo de um canto escuro.",
                choices: [
                    { text: "Investigar o barulho", next: "noise", sanityChange: -25 },
                    { text: "Examinar a mesa com correntes", next: "table", sanityChange: -20 },
                    { text: "Correr de volta para cima", next: "backdoor", sanityChange: -15 },
                    { text: "Esconder-se atr√°s dos m√≥veis", next: "hide", sanityChange: -10 }
                ]
            },
            hide: {
                text: "Voc√™ se esconde rapidamente atr√°s de um arm√°rio velho coberto por um len√ßol. Os segundos parecem horas enquanto voc√™ espera, ouvindo apenas o som do seu pr√≥prio cora√ß√£o. De repente, voc√™ ouve passos lentos e pesados descendo as escadas. A criatura parece estar procurando por algo... ou por algu√©m. Depois de alguns minutos que parecem uma eternidade, os passos recuam e voc√™ ouve a criatura subindo as escadas novamente.",
                choices: [
                    { text: "Sair do esconderijo e investigar a mesa", next: "table", sanityChange: -5 },
                    { text: "Tentar sair do por√£o silenciosamente", next: "backdoor", sanityChange: -8 },
                    { text: "Continuar escondido por mais tempo", next: "hide_longer", sanityChange: -15 }
                ]
            },
            hide_longer: {
                text: "Voc√™ decide ficar escondido por mais tempo. Seus m√∫sculos come√ßam a doer da posi√ß√£o desconfort√°vel. De repente, voc√™ ouve um sussurro muito pr√≥ximo: 'Eu sei que voc√™ est√° a√≠...'. A criatura nunca foi embora! Ela estava apenas esperando. Antes que voc√™ possa reagir, uma m√£o ossuda agarra seu ombro...",
                gameOver: true,
                title: "ENCONTRADO",
                ending: "A criatura o encontrou. Sua jornada na Mans√£o Blackwood chegou ao fim."
            },
            table: {
                text: "Voc√™ se aproxima da mesa com correntes. As manchas escuras s√£o definitivamente sangue seco. Nas correntes, h√° peda√ßos de tecido rasgado. Embaixo da mesa, voc√™ encontra uma chave dourada presa ao ch√£o por uma corrente pequena. Voc√™ consegue solt√°-la. Esta deve ser a chave para alguma porta importante da mans√£o.",
                choices: [
                    { text: "Pegar a chave e investigar o barulho", next: "noise", sanityChange: -10 },
                    { text: "Pegar a chave e sair do por√£o", next: "backdoor", sanityChange: -5 },
                    { text: "Deixar a chave e investigar o barulho", next: "noise", sanityChange: -20 }
                ],
                onEnter: function() {
                    gameState.hasKey = true;
                }
            },
            noise: {
                text: "Voc√™ se aproxima cautelosamente do canto escuro. Seus olhos gradualmente se ajustam √† escurid√£o, e voc√™ v√™ uma figura encolhida no ch√£o. Quando ela levanta a cabe√ßa, voc√™ reconhece o rosto p√°lido e assustado de sua irm√£! 'Voc√™ veio!' ela sussurra. 'Temos que sair daqui agora! Ele vai voltar a qualquer momento!' Antes que voc√™ possa responder, voc√™ ouve passos pesados descendo as escadas.",
                choices: [
                    { text: "Fugir com sua irm√£ pela sa√≠da dos fundos", next: "escape", sanityChange: 30 },
                    { text: "Enfrentar o que est√° vindo", next: "confront", sanityChange: -30 },
                    { text: "Esconder-se com sua irm√£", next: "hide_together", sanityChange: -15 },
                    { text: "Perguntar quem √© 'ele'", next: "ask_who", sanityChange: -20 }
                ],
                onEnter: function() {
                    gameState.foundSister = true;
                }
            },
            hide_together: {
                text: "Voc√™ e sua irm√£ se escondem atr√°s dos m√≥veis. Os passos pesados ecoam no por√£o. A criatura parece estar procurando, mas n√£o os encontra. Depois de alguns minutos tensos, ela sobe as escadas novamente. 'Agora!' sussurra sua irm√£. 'Temos que ir agora enquanto ela est√° distra√≠da!'",
                choices: [
                    { text: "Sair do esconderijo e fugir", next: "escape", sanityChange: 10 },
                    { text: "Esperar um pouco mais", next: "hide_together_longer", sanityChange: -10 }
                ]
            },
            hide_together_longer: {
                text: "Voc√™ decide esperar um pouco mais. De repente, a criatura retorna ao por√£o, desta vez com mais velocidade. 'Cheira a... medo', sussurra uma voz rouca. Antes que possam reagir, a criatura arranca o m√≥vel que os protegia...",
                gameOver: true,
                title: "DESCOBERTOS",
                ending: "A espera foi fatal. A criatura os encontrou."
            },
            ask_who: {
                text: "'Quem √© ele?' voc√™ pergunta em voz baixa. Sua irm√£ treme. 'N√£o sei seu nome... s√≥ vejo seus olhos... olhos que brilham no escuro... ele fica nas paredes, entre as sombras...' Nesse momento, os passos se aceleram. A criatura parece ter ouvido voc√™s!",
                choices: [
                    { text: "Fugir agora!", next: "escape", sanityChange: 5 },
                    { text: "Preparar-se para enfrent√°-la", next: "confront", sanityChange: -25 }
                ]
            },
            escape: {
                text: "Voc√™ agarra sua irm√£ pela m√£o e os dois correm para a escada, subindo dois degraus de cada vez. Os passos pesados est√£o logo atr√°s de voc√™s. Voc√™s alcan√ßam a cozinha. A porta dos fundos est√° trancada!",
                choices: gameState.hasKey ? [
                    { text: "Usar a chave dourada na porta", next: "escape_success", sanityChange: 5 }
                ] : [
                    { text: "Procurar por outra sa√≠da", next: "kitchen", sanityChange: -10 },
                    { text: "Tentar for√ßar a porta", next: "force_door_escape", sanityChange: -15 }
                ]
            },
            escape_success: {
                text: "Com m√£os tr√™mulas, voc√™ insere a chave dourada na fechadura. Ela gira suavemente, e a porta se abre com um rangido alto. Voc√™s saem correndo para a noite, n√£o parando at√© a mans√£o ficar para tr√°s. Voc√™s conseguem chegar √† cidade e chamar a pol√≠cia. Quando eles retornam √† mans√£o, n√£o encontram nada al√©m de uma casa velha e vazia. Voc√™s sobrevivem, mas ambos est√£o marcados pela experi√™ncia.",
                gameOver: true,
                title: "ESCAPE BEM SUCEDIDO",
                ending: "Voc√™ resgatou sua irm√£ e escapou da Mans√£o Blackwood!"
            },
            force_door_escape: {
                text: "Voc√™ tenta for√ßar a porta com todas as suas for√ßas. Ela range, mas n√£o cede. Os passos pesados est√£o cada vez mais pr√≥ximos. Sua irm√£ olha para voc√™ com p√¢nico nos olhos. '√â tarde demais', ela sussurra, enquanto uma sombra cai sobre voc√™s...",
                gameOver: true,
                title: "SEM SA√çDA",
                ending: "A porta n√£o cedeu a tempo. A criatura os alcan√ßou."
            },
            confront: {
                text: "Voc√™ se posiciona na frente de sua irm√£, pronto para enfrentar o que quer que esteja descendo as escadas. Uma figura alta e distorcida aparece, com membros muito longos e um rosto sem caracter√≠sticas definidas. 'Outro visitante', sussurra uma voz que parece vir de todos os lados ao mesmo tempo. Voc√™ sente uma dor de cabe√ßa excruciante enquanto a criatura se aproxima.",
                choices: [
                    { text: "Atacar a criatura", next: "attack_creature", sanityChange: -40 },
                    { text: "Tentar correr passando por ela", next: "run_past", sanityChange: -20 },
                    { text: "Ficar parado e rezar", next: "pray", sanityChange: -30 }
                ]
            },
            attack_creature: {
                text: "Voc√™ se lan√ßa contra a criatura, mas suas m√£os passam direto por ela como se fosse fuma√ßa. 'Pobrezinho... voc√™ n√£o entende, n√£o √©?' ri a criatura. 'Eu n√£o estou aqui... estou em toda parte!' A dor de cabe√ßa se intensifica at√© que tudo fica escuro...",
                gameOver: true,
                title: "SANIDADE PERDIDA",
                ending: "Voc√™ tentou lutar contra algo que n√£o pode ser combatido. Sua mente se despeda√ßou."
            },
            run_past: {
                text: "Voc√™ agarra sua irm√£ e tenta correr passando pela criatura. Por um momento, parece que voc√™s v√£o conseguir. Mas ent√£o a criatura se estica de maneira n√£o natural, bloqueando completamente a passagem. 'Para onde voc√™ acha que vai?' sussurra ela, enquanto suas m√£os ossudas se fecham ao seu redor...",
                gameOver: true,
                title: "SEM ESCAPE",
                ending: "N√£o h√° como escapar daquilo que habita as sombras."
            },
            pray: {
                text: "Voc√™ fecha os olhos e reza. Para sua surpresa, a criatura hesita. 'F√©...', sussurra ela com desgosto. 'Sempre foi um obst√°culo.' Ela recua alguns passos. 'V√° ent√£o... mas saiba que esta casa sempre estar√° esperando por voc√™...' Voc√™s correm para a escada, mas sua sanidade est√° seriamente abalada.",
                choices: [
                    { text: "Fugir pela cozinha", next: "escape", sanityChange: -15 },
                    { text: "Continuar rezando", next: "pray_more", sanityChange: -25 }
                ]
            },
            pray_more: {
                text: "Voc√™ continua rezando, achando que est√° funcionando. Mas a criatura apenas ri. 'Sua f√© √© fraca... como todas as outras.' Ela avan√ßa rapidamente e tudo fica escuro...",
                gameOver: true,
                title: "F√â INSUFICIENTE",
                ending: "Sua f√© n√£o foi forte o suficiente para afastar o mal."
            },
            crying_room: {
                text: "Voc√™ segue o som do choro at√© uma porta que est√° levemente entreaberta. Ao empurr√°-la, voc√™ encontra um quarto de crian√ßa, decorado com brinquedos antigos e um ber√ßo. No centro do quarto, uma figura pequena est√° de costas para voc√™, chorando. Quando ela se vira, voc√™ v√™ que n√£o tem rosto, apenas uma superf√≠cie lisa e p√°lida. Ela estende uma m√£o em sua dire√ß√£o e sussurra: 'Por que voc√™ demorou tanto?'",
                choices: [
                    { text: "Correr para fora do quarto", next: "stairs", sanityChange: -20 },
                    { text: "Perguntar sobre sua irm√£", next: "ask_sister", sanityChange: -15 },
                    { text: "Tentar ajudar a criatura", next: "help_creature", sanityChange: -25 },
                    { text: "Fechar os olhos e contar at√© dez", next: "stairs", sanityChange: -10 }
                ]
            },
            ask_sister: {
                text: "'Onde est√° minha irm√£?' voc√™ pergunta. A criatura sem rosto inclina a cabe√ßa. 'Ela est√° onde todas as coisas perdidas v√£o... no escuro entre as paredes...' A figura come√ßa a se dissolver em n√©voa. 'Procure nas funda√ß√µes... onde as sombras dan√ßam...'",
                choices: [
                    { text: "Correr para fora do quarto", next: "stairs", sanityChange: -15 },
                    { text: "Perguntar mais", next: "ask_more", sanityChange: -20 }
                ]
            },
            ask_more: {
                text: "'O que voc√™ quer dizer?' voc√™ insiste. A criatura agora √© apenas uma silhueta fantasmag√≥rica. 'A casa se alimenta... de medo, de mem√≥rias... sua irm√£ ainda tem muito a dar...' A voz desaparece junto com a figura. Voc√™ est√° sozinho no quarto.",
                choices: [
                    { text: "Sair do quarto", next: "stairs", sanityChange: -20 },
                    { text: "Procurar pistas no quarto", next: "search_room", sanityChange: -10 }
                ]
            },
            search_room: {
                text: "Voc√™ procura no quarto e encontra um di√°rio infantil escondido sob o travesseiro. As p√°ginas est√£o cheias de desenhos de uma fam√≠lia feliz que gradualmente se tornam distorcidos e assustadores. A √∫ltima p√°gina diz: 'Papai n√£o √© mais papai. A casa o pegou.'",
                choices: [
                    { text: "Levar o di√°rio", next: "stairs", sanityChange: -5 },
                    { text: "Deixar o di√°rio", next: "stairs", sanityChange: -8 }
                ]
            },
            help_creature: {
                text: "Voc√™ se aproxima da criatura e estende a m√£o. 'Posso ajud√°-la?' A figura sem rosto come√ßa a tremer violentamente. 'Ajude... ajude...' sussurra ela, antes de explodir em milhares de fragmentos de vidro que se estilha√ßam por todo o quarto. Um deles corta seu bra√ßo. A dor √© intensa, mas n√£o t√£o intensa quanto o vazio que agora preenche o quarto.",
                choices: [
                    { text: "Correr para fora do quarto", next: "stairs", sanityChange: -30 },
                    { text: "Examinar os fragmentos", next: "examine_shards", sanityChange: -35 }
                ]
            },
            examine_shards: {
                text: "Voc√™ se ajoelha para examinar os fragmentos de vidro. Cada um reflete uma mem√≥ria diferente - algumas suas, algumas de estranhos. Em um fragmento, voc√™ v√™ sua irm√£ gritando. Em outro, v√™ a si mesmo entrando na mans√£o. A realidade come√ßa a se desfazer ao seu redor...",
                gameOver: true,
                title: "REALIDADE FRAGMENTADA",
                ending: "Voc√™ olhou para onde n√£o devia. Sua mente n√£o conseguiu juntar os peda√ßos novamente."
            },
            // Adicionando as cenas restantes que estavam faltando
            book: {
                text: "Voc√™ se aproxima do livro aberto no ch√£o. √â um di√°rio antigo, com p√°ginas amareladas e escrita √† m√£o. A p√°gina aberta descreve rituais estranhos e menciona 'o Senhor das Sombras'. H√° um desenho de uma criatura com membros alongados e sem rosto. De repente, voc√™ sente que n√£o est√° sozinho na sala.",
                choices: [
                    { text: "Continuar lendo o di√°rio", next: "diary_reading", sanityChange: -15 },
                    { text: "Fechar o livro e sair", next: "library_exit", sanityChange: -5 },
                    { text: "Levar o di√°rio com voc√™", next: "take_diary", sanityChange: -10 },
                    { text: "Esconder-se atr√°s da poltrona", next: "hide_library", sanityChange: -8 }
                ]
            },
            library_exit: {
                text: "Voc√™ encontra uma porta na parede oposta √† janela. Ela est√° trancada, mas voc√™ nota que h√° uma fechadura antiga que parece fr√°gil. Talvez possa ser for√ßada. Ou voc√™ poderia tentar encontrar outra sa√≠da.",
                choices: [
                    { text: "Tentar for√ßar a porta", next: "force_library_door", sanityChange: -5 },
                    { text: "Voltar pela janela", next: "start", sanityChange: 2 },
                    { text: "Procurar por uma chave", next: "search_key_library", sanityChange: -3 }
                ]
            },
            bookshelves: {
                text: "Voc√™ examina as estantes de livros. A maioria s√£o tomos antigos sobre ocultismo, hist√≥ria local e psicologia. Um livro em particular chama sua aten√ß√£o: 'A Hist√≥ria da Fam√≠lia Blackwood: Uma Linhagem de Trag√©dia'. Voc√™ o puxa da estante e uma se√ß√£o secreta da estante se abre revelando uma passagem escura.",
                choices: [
                    { text: "Entrar na passagem secreta", next: "secret_passage", sanityChange: -10 },
                    { text: "Deixar como est√° e voltar", next: "window", sanityChange: -2 }
                ]
            },
            shadow: {
                text: "Voc√™ se aproxima da sombra no final do corredor. Quanto mais perto voc√™ chega, mais ela parece se dissolver. Quando voc√™ alcan√ßa o final do corredor, n√£o h√° nada l√° - apenas uma janela quebrada e o vento noturno. De repente, voc√™ sente uma presen√ßa atr√°s de voc√™. Ao se virar, voc√™ v√™ a mesma sombra, mas agora est√° no in√≠cio do corredor, entre voc√™ e as escadas.",
                choices: [
                    { text: "Correr em dire√ß√£o √† sombra", next: "run_toward_shadow", sanityChange: -20 },
                    { text: "Tentar uma das portas do corredor", next: "try_door", sanityChange: -10 },
                    { text: "Pular pela janela", next: "jump_window", sanityChange: -30 }
                ]
            },
            bedroom: {
                text: "Voc√™ abre a primeira porta √† esquerda e entra em um quarto de h√≥spedes. A cama est√° arrumada perfeitamente, como se algu√©m esperasse um visitante a qualquer momento. No criado-mudo, h√° um √∫nico copo de √°gua. A √°gua parece fresca. No arm√°rio, voc√™ encontra roupas que parecem do tamanho da sua irm√£.",
                choices: [
                    { text: "Procurar por mais pistas", next: "search_bedroom", sanityChange: -7 },
                    { text: "Beber a √°gua", next: "drink_water", sanityChange: -15 },
                    { text: "Sair do quarto", next: "stairs", sanityChange: -3 }
                ]
            },
            // Adicionando fun√ß√µes onEnter para algumas cenas
            livingroom_book: {
                text: "Voc√™ examina o livro na mesa. Ele fala sobre entidades que existem nos 'espa√ßos entre' a realidade. Uma passagem est√° marcada: 'A chave para manter a sanidade √© lembrar quem voc√™ √©, n√£o importa o que a casa tente fazer voc√™ acreditar.' Isso parece um bom conselho.",
                choices: [
                    { text: "Levar o livro", next: "livingroom", sanityChange: 5 },
                    { text: "Deixar o livro", next: "livingroom", sanityChange: 0 }
                ]
            },
            portrait: {
                text: "Voc√™ examina o retrato sem olhos. De perto, voc√™ percebe que os olhos n√£o foram arrancados - eles nunca foram pintados. O resto do retrato √© t√£o detalhado que essa omiss√£o √© perturbadora. Voc√™ nota uma inscri√ß√£o na parte inferior: 'Elias Blackwood, 1873-1921'. A data de morte est√° riscada e '????' est√° escrito por cima.",
                choices: [
                    { text: "Tocar o retrato", next: "touch_portrait", sanityChange: -12 },
                    { text: "Voltar a examinar a sala", next: "livingroom", sanityChange: -5 }
                ]
            },
            touch_portrait: {
                text: "Ao tocar o retrato, a pintura come√ßa a sangrar de onde os olhos deveriam estar. Um l√≠quido escuro e espesso escorre pela parede. 'Vejo voc√™...' sussurra uma voz vinda do retrato. O l√≠quido forma palavras no ch√£o: 'ELE EST√Å NO POR√ÉO'.",
                choices: [
                    { text: "Correr para fora da sala", next: "entrance", sanityChange: -20 },
                    { text: "Ler as palavras com mais aten√ß√£o", next: "read_words", sanityChange: -25 }
                ]
            },
            // Continuando com as cenas restantes...
            secret_passage: {
                text: "Voc√™ entra na passagem secreta. √â estreita e escura, cheirando a mofo e terra. A passagem desce em espiral. Ap√≥s alguns minutos caminhando, voc√™ emerge em um lugar familiar - o por√£o! Voc√™ est√° atr√°s de uma estante falsa.",
                choices: [
                    { text: "Investigar o por√£o", next: "basement", sanityChange: -5 },
                    { text: "Voltar pela passagem", next: "bookshelves", sanityChange: -3 }
                ]
            }
        };
        
        // Inicializar jogo
        function initGame() {
            // Primeiro toque para habilitar √°udio (requisito do mobile)
            if (isMobile) {
                document.body.addEventListener('touchstart', function init() {
                    if (gameState.soundEnabled) {
                        bgSound.play().catch(e => console.log("√Åudio precisa de intera√ß√£o"));
                    }
                    document.body.removeEventListener('touchstart', init);
                }, { once: true });
            }
            
            showScene("start");
        }
        
        // Fun√ß√£o para atualizar a barra de sanidade
        function updateSanity(change) {
            gameState.sanity += change;
            
            // Limitar sanidade entre 0 e 100
            if (gameState.sanity > 100) gameState.sanity = 100;
            if (gameState.sanity < 0) gameState.sanity = 0;
            
            // Atualizar visualmente
            sanityFill.style.width = `${gameState.sanity}%`;
            sanityValue.textContent = `${gameState.sanity}%`;
            
            // Atualizar texto descritivo
            let sanityStatus = "";
            if (gameState.sanity >= 80) sanityStatus = "Est√°vel";
            else if (gameState.sanity >= 60) sanityStatus = "Levemente Abalada";
            else if (gameState.sanity >= 40) sanityStatus = "Abalada";
            else if (gameState.sanity >= 20) sanityStatus = "Cr√≠tica";
            else sanityStatus = "√Ä Beira da Loucura";
            
            sanityText.textContent = sanityStatus;
            
            // Efeito visual quando a sanidade est√° baixa
            if (gameState.sanity < 30) {
                sanityFill.style.animation = "pulse 1s infinite";
            } else {
                sanityFill.style.animation = "none";
            }
            
            // Verificar se a sanidade chegou a zero
            if (gameState.sanity <= 0) {
                gameOver("Sua sanidade se esgotou completamente. A realidade desmorona ao seu redor e voc√™ perde o controle de sua mente.", "SANIDADE ESGOTADA");
            }
        }
        
        // Fun√ß√£o para mostrar cena
        function showScene(sceneId) {
            const scene = scenes[sceneId];
            
            if (!scene) {
                console.error(`Cena "${sceneId}" n√£o encontrada!`);
                gameOver("O jogo encontrou um erro. Esta cena n√£o existe: " + sceneId, "ERRO NO JOGO");
                return;
            }
            
            gameState.currentScene = sceneId;
            gameState.visitedScenes.add(sceneId);
            
            // Executar fun√ß√£o onEnter se existir
            if (scene.onEnter) {
                scene.onEnter();
            }
            
            // Atualizar texto da hist√≥ria
            storyText.textContent = scene.text;
            
            // Rolagem autom√°tica para o topo
            storyText.parentElement.scrollTop = 0;
            
            // Limpar escolhas anteriores
            choicesContainer.innerHTML = "";
            
            // Se for um fim de jogo
            if (scene.gameOver) {
                gameOver(scene.ending, scene.title);
                return;
            }
            
            // Verificar se h√° escolhas
            if (!scene.choices || scene.choices.length === 0) {
                console.error(`Cena "${sceneId}" n√£o tem escolhas!`);
                scene.choices = [
                    { text: "Continuar...", next: "start", sanityChange: 0 }
                ];
            }
            
            // Adicionar novas escolhas
            scene.choices.forEach((choice, index) => {
                const button = document.createElement("button");
                button.className = "choice-btn";
                button.textContent = choice.text;
                
                // Adicionar efeito de j√° visitada
                if (gameState.visitedScenes.has(choice.next)) {
                    button.style.opacity = "0.8";
                    button.style.borderStyle = "dashed";
                }
                
                // Verificar se a pr√≥xima cena existe
                if (!scenes[choice.next] && choice.next !== "start") {
                    console.error(`Escolha "${choice.text}" leva para cena inexistente: ${choice.next}`);
                    button.textContent += " (erro)";
                    button.disabled = true;
                    button.style.opacity = "0.5";
                }
                
                // Evento de toque/click
                button.addEventListener('click', () => {
                    // Efeito sonoro
                    if (gameState.soundEnabled) {
                        clickSound.currentTime = 0;
                        clickSound.play().catch(e => console.log("Erro no √°udio"));
                    }
                    
                    // Atualizar sanidade
                    updateSanity(choice.sanityChange);
                    
                    // Feedback visual
                    button.style.transform = "scale(0.95)";
                    setTimeout(() => {
                        button.style.transform = "";
                    }, 200);
                    
                    // Mostrar pr√≥xima cena
                    setTimeout(() => showScene(choice.next), 300);
                });
                
                // Suporte para toque prolongado (mobile)
                button.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    button.style.background = "#333";
                });
                
                button.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    button.style.background = "";
                });
                
                choicesContainer.appendChild(button);
            });
        }
        
        // Fun√ß√£o de fim de jogo
        function gameOver(message, title) {
            gameOverTitle.textContent = title;
            gameOverText.textContent = message;
            gameOverScreen.style.display = "flex";
            
            // Parar √°udio de fundo
            if (gameState.soundEnabled) {
                bgSound.pause();
            }
        }
        
        // Reiniciar jogo
        function restartGame() {
            // Resetar estado do jogo
            gameState = {
                sanity: 100,
                currentScene: "start",
                soundEnabled: gameState.soundEnabled,
                visitedScenes: new Set(["start"]),
                foundSister: false,
                hasKey: false
            };
            
            // Resetar sanidade visualmente
            sanityFill.style.width = "100%";
            sanityValue.textContent = "100%";
            sanityText.textContent = "Est√°vel";
            sanityFill.style.animation = "none";
            
            // Esconder tela de game over
            gameOverScreen.style.display = "none";
            
            // Mostrar cena inicial
            showScene("start");
        }
        
        // Configurar bot√£o de rein√≠cio
        restartBtn.addEventListener('click', restartGame);
        
        // Iniciar jogo quando a p√°gina carregar
        window.addEventListener('DOMContentLoaded', initGame);
        
        // Prevenir comportamento padr√£o de toque
        document.addEventListener('touchmove', (e) => {
            if (e.scale !== 1) {
                e.preventDefault();
            }
        }, { passive: false });
        
        // Adicionar estilo para pulso quando sanidade baixa
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0% { opacity: 1; }
                50% { opacity: 0.7; }
                100% { opacity: 1; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>